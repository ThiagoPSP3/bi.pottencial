<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pottenccial BI Hub</title>
    <style>
      :root {
        --brand-orange: #f27020;
        --brand-dark: #c15a18;
        --background: #f5f5f5;
        --text-dark: #4d4d4d;
        --text-light: #ffffff;
        --card-radius: 18px;
        --sidebar-width: clamp(60px, 5vh, 100px);
      }

      * {
        box-sizing: border-box;
        font-family: "Poppins", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      html,
      body {
        height: 100%;
      }

      body {
        margin: 0;
        background: var(--background);
        color: var(--text-dark);
        overflow: hidden;
      }

      .app-shell {
        display: grid;
        grid-template-columns: var(--sidebar-width) 1fr;
        height: 100%;
        min-height: 0;
      }

      nav {
        background: linear-gradient(180deg, var(--brand-orange), var(--brand-dark));
        color: var(--text-light);
        padding: 8px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .logo {
        display: flex;
        justify-content: center;
        padding: 0;
        margin: 0 -12px;
      }

      .logo-link {
        display: flex;
        width: 100%;
        justify-content: center;
        padding: 0;
        border-radius: 0 0 1% 1%;
        transition: background 0.2s ease;
      }


      .logo img {
        width: 100%;
        height: auto;
        display: block;
        max-width: 80%;
      }

      .nav-items {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 8px;
        overflow: hidden;
        padding: 0;
      }

      .nav-button {
        border: 0;
        border-radius: 10px;
        padding: 8px 8px;
        background: rgba(255, 255, 255, 0.12);
        color: inherit;
        cursor: pointer;
        font-weight: 600;
        text-transform: uppercase;
        writing-mode: sideways-lr;
        transition: background 0.2s ease;
      }

      .nav-button:hover,
      .nav-button.active {
        background: #ffffff;
        color: var(--brand-orange);
      }


      main {
        padding: 0;
        display: grid;
        grid-template-rows: var(--sidebar-width) 1fr;
        gap: 0;
        height: 100%;
        overflow: hidden;
        min-height: 0;
      }

      .top-bar {
        grid-row: 1;
        background: var(--brand-orange);
        color: var(--text-light);
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        height: var(--sidebar-width);
        padding: 0 24px;
        box-shadow: 0 8px 20px -12px rgba(0, 0, 0, 0.35);
      }

      .top-bar-title {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .top-bar-actions {
        position: absolute;
        right: 24px;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .top-bar-action {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: calc(var(--sidebar-width) * 0.6);
        height: calc(var(--sidebar-width) * 0.6);
        max-width: 52px;
        max-height: 52px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        text-decoration: none;
        color: var(--text-light);
        font-size: 18px;
        font-weight: 700;
        border: 0;
        cursor: pointer;
        transition: background 0.2s ease, transform 0.2s ease;
      }

      .top-bar-action:hover,
      .top-bar-action:focus-visible {
        background: rgba(255, 255, 255, 0.35);
        transform: translateY(-1px);
      }

      .top-bar-action:focus-visible {
        outline: 3px solid rgba(255, 255, 255, 0.5);
        outline-offset: 2px;
      }

      .top-bar-action:active {
        transform: translateY(0);
      }

      .top-bar-action.top-bar-help {
        text-decoration: none;
      }

      .top-bar-action.top-bar-fullscreen {
        background: rgba(255, 255, 255, 0.18);
      }

      .view {
        display: none;
        animation: fadeIn 0.3s ease forwards;
        overflow: hidden;
        min-height: 0;
        grid-row: 2;
      }

      .view.active {
        display: flex;
        flex-direction: column;
        flex: 1 1 auto;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .theme-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        padding: 12px;
        gap: 16px;
        align-content: start;
        flex: 1 1 auto;
      }

      .theme-card,
      .panel-card {
        background: white;
        border-radius: var(--card-radius);
        padding: 24px;
        box-shadow: 0 18px 35px -25px rgba(0, 0, 0, 0.4);
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .theme-card:hover,
      .panel-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 16px 32px -22px rgba(0, 0, 0, 0.45);
      }

      .theme-card h3 {
        margin-top: 0;
        color: var(--brand-orange);
      }

      .theme-card p {
        margin-bottom: 0;
        color: #666;
      }

      .panel-card {
        display: flex;
        flex-direction: column;
        gap: 12px;
        width: 100%;
        padding: 16px;
        min-height: 320px;
        overflow: hidden;
      }

      .panel-thumb {
        width: 100%;
        aspect-ratio: 16 / 9;
        border-radius: 12px;
        background: linear-gradient(135deg, rgba(242, 112, 32, 0.25), rgba(242, 112, 32, 0.55));
        display: flex;
        align-items: center;
        justify-content: center;
        flex: 0 0 auto;
        color: var(--brand-dark);
        font-weight: 600;
      }

      .panel-thumb.placeholder {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: linear-gradient(135deg, rgba(255, 178, 56, 0.25), rgba(157, 116, 27, 0.3));
        border: 1px dashed rgba(242, 112, 32, 0.45);
      }

      .panel-card h4 {
        margin: 8px 0 0;
        color: var(--brand-orange);
        font-size: clamp(0.9rem, 1.2vw, 1.1rem);
        line-height: 1.25;
        flex: 0 0 auto;
      }

      .panel-card p {
        margin: 0;
        font-size: clamp(0.78rem, 1vw, 0.95rem);
        color: #7a7a7a;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        flex: 1 1 auto;
        overflow-y: auto;
        overflow-x: hidden;
      }

      .theme-submenu {
        list-style: none;
        padding: 0px;
        margin: 18px 0 0;
        display: grid;
        gap: 10px;
      }

      .theme-submenu button {
        border: 1px solid #f0f0f0;
        background: #fafafa;
        border-radius: 12px;
        padding: 10px 14px;
        text-align: left;
        font-weight: 600;
        color: var(--brand-orange);
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        transition: background 0.2s ease, transform 0.2s ease;
      }

      .theme-submenu button::after {
        content: ">";
        font-size: 16px;
        color: #c7c7c7;
      }

      .theme-submenu button:hover {
        background: #fff2e9;
        transform: translateX(2px);
      }

      .menu-error {
        background: #fff2e9;
        border-radius: var(--card-radius);
        padding: 24px;
        color: var(--brand-dark);
        font-weight: 600;
        box-shadow: 0 18px 35px -25px rgba(0, 0, 0, 0.25);
      }

      .panel-empty {
        background: #fff;
        border-radius: var(--card-radius);
        padding: 24px;
        text-align: center;
        color: var(--brand-dark);
        font-weight: 600;
        box-shadow: 0 18px 35px -25px rgba(0, 0, 0, 0.15);
      }

      .theme-empty {
        margin: 14px 0 0;
        font-size: 13px;
        color: #999;
        font-weight: 500;
      }

      .panel-grid {
        display: grid;
        grid-template-columns: repeat(4, minmax(220px, 1fr));
        gap: 16px;
        padding: 16px;
        flex: 1 1 auto;
        height: 100%;
        overflow-y: auto;
        grid-auto-rows: calc((100vw - 160px) / 4); /* mesma altura da largura das colunas */
        align-items: start;
      }
      .embed-wrapper {
        display: flex;
        flex-direction: column;
        gap: 12px;
        flex: 1 1 auto;
        min-height: 0;
        padding: 0px;
        box-sizing: border-box;
      }
      .embed-wrapper iframe {
        width: 100%;
        height: 100%;
        flex: 1 1 auto;
        border: 0;
        border-radius: 14px;
        box-shadow: 0 12px 28px -18px rgba(0, 0, 0, 0.4);
      }

      .embed-placeholder {
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 16px;
        width: 100%;
        height: 100%;
        border-radius: 14px;
        border: 1px dashed rgba(242, 112, 32, 0.35);
        background: #fff7ec;
        color: var(--brand-orange);
        text-align: center;
        padding: 32px;
        box-shadow: 0 20px 35px -30px rgba(0, 0, 0, 0.35);
      }

      .embed-placeholder.active {
        display: flex;
      }

      .embed-placeholder-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
        max-width: 360px;
      }

      .embed-placeholder-card h3 {
        margin: 0;
        font-size: 18px;
        color: var(--brand-orange);
      }

      .embed-placeholder-card p {
        margin: 0;
        font-size: 14px;
        color: #7a4d1c;
      }

      .placeholder-icon {
        width: 48px;
        height: 48px;
        display: inline-block;
        background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%23f2c811'/%3E%3Cpath d='M18 46h8V18h-8v28zm12 0h8V24h-8v22zm12 0h8V30h-8v16z' fill='%23232323' opacity='.8'/%3E%3C/svg%3E") center/contain no-repeat;
      }

      .panel-thumb.placeholder .placeholder-icon {
        width: 40px;
        height: 40px;
      }

      .panel-thumb.placeholder .placeholder-label {
        margin-top: 8px;
        font-size: 11px;
        font-weight: 600;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: #b86b1b;
      }

      .hidden {
        display: none !important;
      }

      @media (max-width: 960px) {
        .app-shell {
          grid-template-columns: 1fr;
        }

        nav {
          flex-direction: row;
          align-items: center;
          gap: 16px;
          padding: 16px 16px;
          overflow-x: auto;
        }

        .logo {
          flex: 0 0 auto;
          margin: 0;
        }

        .logo-link {
          border-radius: 18px;
        }

        .nav-items {
          flex-direction: row;
          gap: 12px;
          overflow: visible;
          padding-right: 6px;
        }

        main {
          padding: 10px 0 0;
          grid-template-rows: var(--sidebar-width) 1fr;
        }

        .top-bar {
          border-radius: 0 0 24px 24px;
        }
      }
    </style>
  </head>
  <body>
    <div class="app-shell">
      <nav>
        <div class="logo">
          <a href="#" class="logo-link" data-action="go-home" aria-label="Voltar para o início">
            <img src="https://attachments.gupy.io/production/companies/29737/career/70729/images/2024-02-27_17-38_companyLogoUrl.jpg" alt="Pottencial BI Hub" />
          </a>
        </div>
        <div class="nav-items" id="themeNav"></div>
      </nav>
      <main>
        <header class="top-bar">
          <h1 id="pageTitle" class="top-bar-title">Início</h1>
          <div class="top-bar-actions">
            <button
              type="button"
              id="fullscreenToggle"
              class="top-bar-action top-bar-fullscreen"
              title="Tela cheia"
              aria-label="Entrar em tela cheia"
            >
              ⛶
            </button>
            <a
              href="#"
              id="helpMailLink"
              class="top-bar-action top-bar-help"
              title="Ajuda"
              aria-label="Ajuda"
            >
              ?
            </a>
          </div>
        </header>
        <section id="view-themes" class="view active">
          <div class="theme-grid" id="themeGrid"></div>
        </section>

        <section id="view-panels" class="view">
          <div class="panel-grid" id="panelGrid"></div>
        </section>

        <section id="view-embed" class="view">
          <div class="embed-wrapper">
            <div class="embed-placeholder" id="embedPlaceholder" role="status" aria-live="polite">
              <div class="embed-placeholder-card">
                <span class="placeholder-icon" aria-hidden="true"></span>
                <h3 id="embedPlaceholderTitle">Power BI em breve</h3>
                <p id="embedPlaceholderMessage">
                  Estamos preparando o link deste painel no Power BI. Tente novamente mais tarde.
                </p>
              </div>
            </div>
            <iframe
              id="powerBIFrame"
              title="Relatório Power BI"
              src=""
              allowfullscreen
            ></iframe>
          </div>
        </section>
      </main>
    </div>

    <script>
      let data = [];
      const RAW_MENU_DATA = [
        {
          "ordem": 0,
          "nome": "Home",
          "descricao": "Painel Com informações gerais para estar na home",
          "embedUrl": ""
        },
        {
          "ordem": 1,
          "nome": "Comercial",
          "descricao": "Resultados comerciais e acompanhamento estratégico.",
          "paineis": [
            {
              "ordem": 0,
              "nome": "Acompanhamento Metas",
              "descricao": "Performance contra metas por canal, produto e período.",
              "thumb": "Metas",
              "embedUrl": ""
            },
            {
              "ordem": 1,
              "nome": "Mapa Estratégico",
              "descricao": "Indicadores estratégicos alinhados ao plano comercial.",
              "thumb": "Mapa",
              "embedUrl": ""
            },
            {
              "ordem": 2,
              "nome": "Share Mercado",
              "descricao": "Participação de mercado e posicionamento competitivo.",
              "thumb": "Share",
              "embedUrl": ""
            },
            {
              "ordem": 3,
              "nome": "Produção Analítica",
              "descricao": "Detalhe da produção com visão analítica por carteira.",
              "thumb": "Produção",
              "embedUrl": ""
            }
          ]
        },
        {
          "ordem": 2,
          "nome": "Marketing",
          "descricao": "Campanhas, captação e qualidade dos leads.",
          "paineis": [
            {
              "ordem": 0,
              "nome": "Retorno de Campanhas",
              "descricao": "ROI, custos e resultados das campanhas em andamento.",
              "thumb": "Campanhas",
              "embedUrl": ""
            },
            {
              "ordem": 1,
              "nome": "Pottencialize",
              "descricao": "Indicadores-chave do programa Pottenccialize.",
              "thumb": "Pottencialize",
              "embedUrl": ""
            },
            {
              "ordem": 2,
              "nome": "KPIs Qualidade",
              "descricao": "Métricas de qualidade e conversão dos leads gerados.",
              "thumb": "Qualidade",
              "embedUrl": ""
            }
          ]
        },
        {
          "ordem": 3,
          "nome": "Produto",
          "descricao": "Desempenho do portfólio e evolução das ofertas.",
          "paineis": [
            {
              "ordem": 0,
              "nome": "Funil de Vendas",
              "descricao": "Análise do funil de vendas por produto e etapa.",
              "thumb": "Funil",
              "embedUrl": ""
            },
            {
              "ordem": 1,
              "nome": "Renovação Atualização",
              "descricao": "Taxas de renovação e atualizações de contratos.",
              "thumb": "Renovação",
              "embedUrl": ""
            },
            {
              "ordem": 2,
              "nome": "KPIs por Produto",
              "descricao": "KPIs principais detalhados por produto.",
              "thumb": "KPIs Produto",
              "embedUrl": ""
            },
            {
              "ordem": 3,
              "nome": "Pricing",
              "descricao": "Monitoramento de preços, elasticidade e ajustes.",
              "thumb": "Pricing",
              "embedUrl": ""
            },
            {
              "ordem": 4,
              "nome": "Atuarial",
              "descricao": "Modelagens atuariais e projeções de carteira.",
              "thumb": "Atuarial",
              "embedUrl": ""
            },
            {
              "ordem": 1,
              "nome": "Renovação Atualização",
              "descricao": "Taxas de renovação e atualizações de contratos.",
              "thumb": "Renovação",
              "embedUrl": ""
            },
            {
              "ordem": 2,
              "nome": "KPIs por Produto",
              "descricao": "KPIs principais detalhados por produto.",
              "thumb": "KPIs Produto",
              "embedUrl": ""
            },
            {
              "ordem": 3,
              "nome": "Pricing",
              "descricao": "Monitoramento de preços, elasticidade e ajustes.",
              "thumb": "Pricing",
              "embedUrl": ""
            },
            {
              "ordem": 4,
              "nome": "Atuarial",
              "descricao": "Modelagens atuariais e projeções de carteira.",
              "thumb": "Atuarial",
              "embedUrl": ""
            }
          ]
        },
        {
          "ordem": 4,
          "nome": "Operações",
          "descricao": "Gestão operacional e eficiência dos processos.",
          "paineis": [
            {
              "ordem": 0,
              "nome": "Logística",
              "descricao": "Status operacional e indicadores de entrega.",
              "thumb": "Logística",
              "embedUrl": ""
            },
            {
              "ordem": 1,
              "nome": "Faturamento",
              "descricao": "Controle de faturamento e identificação de gargalos.",
              "thumb": "Faturamento",
              "embedUrl": ""
            },
            {
              "ordem": 2,
              "nome": "Prevenção Fraudes",
              "descricao": "Monitoramento de fraudes e alçadas de aprovação.",
              "thumb": "Fraudes",
              "embedUrl": ""
            },
            {
              "ordem": 3,
              "nome": "Qualidade Operações",
              "descricao": "Indicadores de qualidade operacional por área.",
              "thumb": "Qualidade Ops",
              "embedUrl": ""
            }
          ]
        },
        {
          "ordem": 5,
          "nome": "Tecnologia",
          "descricao": "Monitoramento de plataformas e operações digitais.",
          "paineis": [
            {
              "ordem": 0,
              "nome": "Uso das APIs",
              "descricao": "Consumo, performance e disponibilidade das APIs.",
              "thumb": "APIs",
              "embedUrl": ""
            },
            {
              "ordem": 1,
              "nome": "Monitoramento Carga de Dados",
              "descricao": "Status das cargas e saúde dos pipelines de dados.",
              "thumb": "Cargas",
              "embedUrl": ""
            },
            {
              "ordem": 2,
              "nome": "Qualidade",
              "descricao": "Indicadores de qualidade e confiabilidade tecnológica.",
              "thumb": "Qualidade",
              "embedUrl": ""
            }
          ]
        },
        {
          "ordem": 6,
          "nome": "Sinistro",
          "descricao": "Visão completa do ciclo de sinistros.",
          "paineis": [
            {
              "ordem": 0,
              "nome": "Avisos Expectativas",
              "descricao": "Abertura de avisos e expectativas de sinistros.",
              "thumb": "Avisos",
              "embedUrl": ""
            },
            {
              "ordem": 1,
              "nome": "Indenizações Recuperado",
              "descricao": "Pagamentos, recuperações e tempos de atendimento.",
              "thumb": "Indenizações",
              "embedUrl": ""
            },
            {
              "ordem": 2,
              "nome": "Provisionamento",
              "descricao": "Provisões técnicas e evolução por carteira.",
              "thumb": "Provisionamento",
              "embedUrl": ""
            },
            {
              "ordem": 3,
              "nome": "Sinistralidade",
              "descricao": "Taxa de sinistralidade por produto e segmento.",
              "thumb": "Sinistralidade",
              "embedUrl": ""
            },
            {
              "ordem": 4,
              "nome": "Resultado",
              "descricao": "Resultado operacional e margens relacionadas a sinistros.",
              "thumb": "Resultado",
              "embedUrl": ""
            }
          ]
        },
        {
          "ordem": 7,
          "nome": "Atendimento",
          "descricao": "Indicadores de atendimento ao cliente.",
          "paineis": [
            {
              "ordem": 0,
              "nome": "Classificação de Filas",
              "descricao": "Distribuição e priorização das filas de atendimento.",
              "thumb": "Filas",
              "embedUrl": ""
            },
            {
              "ordem": 1,
              "nome": "KPIs Atendimento",
              "descricao": "Níveis de serviço, volumes e satisfação do atendimento.",
              "thumb": "KPIs Atendimento",
              "embedUrl": ""
            },
            {
              "ordem": 2,
              "nome": "Chatbot",
              "descricao": "Eficiência e resultados dos canais automatizados.",
              "thumb": "Chatbot",
              "embedUrl": ""
            }
          ]
        }
      ];

      const themeGrid = document.querySelector("#themeGrid");
      const themeNav = document.querySelector("#themeNav");
      const panelGrid = document.querySelector("#panelGrid");
      const navItemsContainer = document.querySelector(".nav-items");

      const views = {
        themes: document.querySelector("#view-themes"),
        panels: document.querySelector("#view-panels"),
        embed: document.querySelector("#view-embed"),
      };

      const powerBIFrame = document.querySelector("#powerBIFrame");
      const embedPlaceholder = document.querySelector("#embedPlaceholder");
      const embedPlaceholderTitle = document.querySelector("#embedPlaceholderTitle");
      const embedPlaceholderMessage = document.querySelector("#embedPlaceholderMessage");
      const helpMailLink = document.querySelector("#helpMailLink");
      const fullscreenToggle = document.querySelector("#fullscreenToggle");
      const pageTitleElement = document.querySelector("#pageTitle");

      let temaAtual = null;
      let painelAtual = null;
      let viewAtual = "themes";
      let temaHome = null;

      function ajustarFonteMenu() {
        if (!navItemsContainer) {
          if (pageTitleElement) {
            pageTitleElement.style.fontSize = "";
          }
          return;
        }
        const buttons = Array.from(navItemsContainer.querySelectorAll('.nav-button'));
        const topBarActions = Array.from(document.querySelectorAll(".top-bar-action"));
        if (!buttons.length) {
          if (pageTitleElement) {
            pageTitleElement.style.fontSize = "";
          }
          topBarActions.forEach((action) => {
            action.style.fontSize = "";
          });
          return;
        }

        buttons.forEach((btn) => {
          btn.style.fontSize = "";
        });
        if (pageTitleElement) {
          pageTitleElement.style.fontSize = "";
        }
        topBarActions.forEach((action) => {
          action.style.fontSize = "";
        });

        const applyFontSize = (value) => {
          buttons.forEach((btn) => {
            btn.style.fontSize = `${value}px`;
          });
          if (pageTitleElement) {
            pageTitleElement.style.fontSize = `${value}px`;
          }
          topBarActions.forEach((action) => {
            action.style.fontSize = `${value}px`;
          });
        };

        const isMobile = window.matchMedia("(max-width: 960px)").matches;
        if (isMobile) {
          applyFontSize(14);
          return;
        }

        const containerHeight = navItemsContainer.getBoundingClientRect().height;
        if (containerHeight <= 0) {
          applyFontSize(16);
          return;
        }

        let low = 12;
        let high = 48;
        let best = low;

        const fits = () => navItemsContainer.scrollHeight <= containerHeight + 0.5;

        while (high - low > 0.5) {
          const mid = (low + high) / 2;
          buttons.forEach((btn) => {
            btn.style.fontSize = `${mid}px`;
          });

          if (fits()) {
            best = mid;
            low = mid;
          } else {
            high = mid;
          }
        }

        const finalSize = Math.max(12, Math.min(40, best));
        applyFontSize(finalSize);
      }

      function descricaoPaginaAtual() {
        if (viewAtual === "embed" && temaAtual && painelAtual) {
          return `${temaAtual.nome} > ${painelAtual.titulo}`;
        }
        if (viewAtual === "panels" && temaAtual) {
          return temaAtual.nome;
        }
        return "Início";
      }

      function tituloPaginaAtual() {
        if (viewAtual === "embed" && temaAtual && painelAtual) {
          return painelAtual.titulo;
        }
        if (viewAtual === "panels" && temaAtual) {
          return temaAtual.nome;
        }
        return "Início";
      }

      function atualizarTituloPagina() {
        if (!pageTitleElement) return;
        pageTitleElement.textContent = tituloPaginaAtual();
      }

      function atualizarLinkAjuda() {
        if (!helpMailLink) return;
        const pagina = descricaoPaginaAtual();
        const subject = encodeURIComponent(`dúvida painel: ${pagina}`);
        helpMailLink.href = `mailto:analytics@pottencial.com.br?subject=${subject}`;
      }

      function estaEmTelaCheia() {
        return Boolean(
          document.fullscreenElement ||
            document.webkitFullscreenElement ||
            document.mozFullScreenElement ||
            document.msFullscreenElement,
        );
      }

      function entrarTelaCheia(elemento) {
        if (elemento.requestFullscreen) return elemento.requestFullscreen();
        if (elemento.webkitRequestFullscreen) return elemento.webkitRequestFullscreen();
        if (elemento.mozRequestFullScreen) return elemento.mozRequestFullScreen();
        if (elemento.msRequestFullscreen) return elemento.msRequestFullscreen();
        return Promise.reject(new Error("Fullscreen API não suportada."));
      }

      function sairTelaCheia() {
        if (document.exitFullscreen) return document.exitFullscreen();
        if (document.webkitExitFullscreen) return document.webkitExitFullscreen();
        if (document.mozCancelFullScreen) return document.mozCancelFullScreen();
        if (document.msExitFullscreen) return document.msExitFullscreen();
        return Promise.reject(new Error("Fullscreen API não suportada."));
      }

      function atualizarEstadoFullscreen() {
        if (!fullscreenToggle) return;
        const emTelaCheia = estaEmTelaCheia();
        fullscreenToggle.setAttribute("aria-pressed", String(emTelaCheia));
        fullscreenToggle.title = emTelaCheia ? "Sair da tela cheia" : "Tela cheia";
        fullscreenToggle.setAttribute(
          "aria-label",
          emTelaCheia ? "Sair da tela cheia" : "Entrar em tela cheia",
        );
        fullscreenToggle.textContent = emTelaCheia ? "×" : "⛶";
      }

      function slugify(value) {
        return String(value ?? "")
          .normalize("NFD")
          .replace(/[\u0300-\u036f]/g, "")
          .toLowerCase()
          .replace(/[^a-z0-9]+/g, "-")
          .replace(/(^-|-$)/g, "");
      }

      function normalizarMenu(itens) {
        if (!Array.isArray(itens)) return [];

        return itens
          .slice()
          .sort((a, b) => (a?.ordem ?? 0) - (b?.ordem ?? 0))
          .map((item, index) => {
            const temaNome = item?.nome ?? `Tema ${index + 1}`;
            const temaSlug = slugify(temaNome) || `tema-${index + 1}`;
            const possuiPaineis = Array.isArray(item?.paineis);
            const possuiEmbedDireto = Object.prototype.hasOwnProperty.call(item ?? {}, "embedUrl");

            const descricaoBase = item?.descricao ?? "Descrição em breve.";
            let mostrarNoMenu = item?.mostrarNoMenu;
            if (mostrarNoMenu === undefined) {
              mostrarNoMenu = true;
            }

            let dashboards = [];

            if (possuiPaineis) {
              dashboards = item.paineis
                .slice()
                .sort((a, b) => (a?.ordem ?? 0) - (b?.ordem ?? 0))
                .map((painel, painelIndex) => {
                  const painelNome = painel?.nome ?? `Painel ${painelIndex + 1}`;
                  const painelSlug =
                    slugify(painelNome) || `${temaSlug}-painel-${painelIndex + 1}`;
                  const thumbBase =
                    painel?.thumb ?? painelNome.split(" ").slice(0, 2).join(" ");
                  return {
                    id: painelSlug,
                    titulo: painelNome.toUpperCase(),
                    descricao: painel?.descricao ?? "Descrição em breve.",
                    thumb: thumbBase || "Painel",
                    embedUrl: painel?.embedUrl ?? "",
                  };
                });
            } else if (possuiEmbedDireto) {
              const painelNome = item?.nome ?? `Painel ${index + 1}`;
              const thumbBase =
                item?.thumb ?? painelNome.split(" ").slice(0, 2).join(" ");
              dashboards = [
                {
                  id: `${temaSlug}-painel-principal`,
                  titulo: painelNome.toUpperCase(),
                  descricao: descricaoBase,
                  thumb: thumbBase || "Painel",
                  embedUrl: item?.embedUrl ?? "",
                },
              ];
              mostrarNoMenu = item?.mostrarNoMenu ?? false;
            }

            return {
              id: temaSlug,
              nome: temaNome.toUpperCase(),
              descricao: descricaoBase,
              dashboards,
              mostrarNoMenu,
            };
          });
      }

      function carregarMenu() {
        themeGrid.innerHTML = `<div class="menu-error">Carregando menu...</div>`;
        themeNav.innerHTML = "";
        temaHome = null;

        try {
          const json = Array.isArray(RAW_MENU_DATA) ? RAW_MENU_DATA : [];
          data = normalizarMenu(json);
          temaHome = data.find(
            (item) => item.mostrarNoMenu === false && Array.isArray(item.dashboards) && item.dashboards.length,
          ) ?? null;

          if (!data.length) {
            themeGrid.innerHTML = `<div class="menu-error">Nenhum item de menu encontrado.</div>`;
            viewAtual = "themes";
            atualizarLinkAjuda();
            return;
          }

          temaAtual = null;
          painelAtual = null;
          setActiveNav(null);
          renderThemes();

          const primeiroVisivel = data.find(
            (item) => item.mostrarNoMenu !== false && Array.isArray(item.dashboards) && item.dashboards.length,
          );
          const fallbackComPainel = data.find((item) => Array.isArray(item.dashboards) && item.dashboards.length);
          const destinoInicial = temaHome ?? primeiroVisivel ?? fallbackComPainel ?? null;

          if (destinoInicial) {
            const deveAbrirPainel = destinoInicial === temaHome || destinoInicial.mostrarNoMenu === false;
            selecionarTema(destinoInicial.id, { abrirPrimeiroPainel: deveAbrirPainel });
          } else {
            panelGrid.innerHTML = "";
            powerBIFrame.src = "";
            powerBIFrame.classList.add("hidden");
            embedPlaceholder.classList.add("active");
            embedPlaceholderTitle.textContent = "Selecione um painel";
            embedPlaceholderMessage.textContent = "Escolha um painel para visualizar o relatório do Power BI.";
            viewAtual = "themes";
            alternarView("themes");
            atualizarLinkAjuda();
          }
        } catch (error) {
          console.error(error);
          themeGrid.innerHTML = `<div class="menu-error">Não foi possível carregar o menu. Verifique os dados embutidos.</div>`;
          viewAtual = "themes";
          powerBIFrame.classList.add("hidden");
          embedPlaceholder.classList.add("active");
          embedPlaceholderTitle.textContent = "Power BI em breve";
          embedPlaceholderMessage.textContent = "Estamos preparando o link deste painel no Power BI. Tente novamente mais tarde.";
          atualizarLinkAjuda();
        }
      }

      function setActiveNav(themeId, panelId) {
        document.querySelectorAll(".nav-button").forEach((btn) => {
          btn.classList.toggle("active", !!themeId && btn.dataset.theme === themeId);
        });
      }

      function renderThemes() {
        themeGrid.innerHTML = "";
        themeNav.innerHTML = "";

        if (!data.length) {
          themeGrid.innerHTML = `<div class="menu-error">Nenhum item de menu encontrado.</div>`;
          ajustarFonteMenu();
          return;
        }

        const temasVisiveis = data.filter((theme) => theme.mostrarNoMenu !== false);

        if (!temasVisiveis.length) {
          themeGrid.innerHTML = `<div class="menu-error">Nenhum menu disponível para navegação.</div>`;
          ajustarFonteMenu();
          return;
        }

        temasVisiveis.forEach((theme) => {
          const card = document.createElement("article");
          card.className = "theme-card";
          const hasDashboards = Array.isArray(theme.dashboards) && theme.dashboards.length > 0;
          const subItems = hasDashboards
            ? theme.dashboards
                .map(
                  (dash) => `
                <li>
                  <button
                    type="button"
                    class="theme-panel-button"
                    data-theme="${theme.id}"
                    data-panel="${dash.id}"
                  >
                    ${dash.titulo}
                  </button>
                </li>
              `,
                )
                .join("")
            : "";

          const submenuMarkup = hasDashboards
            ? `<ul class="theme-submenu">
              ${subItems}
            </ul>`
            : `<p class="theme-empty">Nenhum painel cadastrado.</p>`;

          card.innerHTML = `
            <h3>${theme.nome}</h3>
            <p>${theme.descricao}</p>
            ${submenuMarkup}
          `;
          card.querySelectorAll(".theme-panel-button").forEach((button) => {
            button.addEventListener("click", (event) => {
              event.stopPropagation();
              const targetTheme = button.dataset.theme;
              const targetPanel = button.dataset.panel;
              if (temaAtual?.id !== targetTheme) {
                selecionarTema(targetTheme);
              }
              selecionarPainel(targetPanel);
            });
          });
          card.addEventListener("click", () => selecionarTema(theme.id));
          themeGrid.appendChild(card);

          const navButton = document.createElement("button");
          navButton.className = "nav-button";
          navButton.textContent = theme.nome;
          navButton.dataset.theme = theme.id;
          navButton.addEventListener("click", () => selecionarTema(theme.id));
          themeNav.appendChild(navButton);
        });

        ajustarFonteMenu();
      }

      function selecionarTema(themeId, { abrirPrimeiroPainel = false } = {}) {
        const theme = data.find((item) => item.id === themeId);
        if (!theme) return;

        temaAtual = theme;
        painelAtual = null;

        panelGrid.innerHTML = "";
        const dashboards = Array.isArray(theme.dashboards) ? theme.dashboards : [];

        if (!dashboards.length) {
          panelGrid.innerHTML = `<div class="panel-empty">Nenhum painel cadastrado para este tema.</div>`;
        } else {
          dashboards.forEach((dash) => {
            const embedUrl = dash.embedUrl && String(dash.embedUrl).trim();
            const hasEmbed = Boolean(embedUrl);
            const thumbMarkup = hasEmbed
              ? `<div class="panel-thumb">${dash.thumb}</div>`
              : `<div class="panel-thumb placeholder" aria-label="Power BI em breve"><span class="placeholder-icon" aria-hidden="true"></span><span class="placeholder-label">Em breve</span></div>`;

            const card = document.createElement("article");
            card.className = "panel-card";
            card.dataset.hasEmbed = hasEmbed;
            card.innerHTML = `
              ${thumbMarkup}
              <h4>${dash.titulo}</h4>
              <p>${dash.descricao}</p>
            `;
            card.addEventListener("click", () => selecionarPainel(dash.id));
            panelGrid.appendChild(card);
          });
        }

        setActiveNav(theme.id);

        if (abrirPrimeiroPainel && dashboards.length) {
          selecionarPainel(dashboards[0].id);
        } else {
          alternarView("panels");
        }
      }

      function selecionarPainel(panelId) {
        if (!temaAtual) return;
        const panel = temaAtual.dashboards.find((item) => item.id === panelId);
        if (!panel) return;

        painelAtual = panel;
        setActiveNav(temaAtual.id, panel.id);

        const embedUrl = panel.embedUrl && String(panel.embedUrl).trim();

        if (embedUrl) {
          powerBIFrame.classList.remove("hidden");
          powerBIFrame.src = embedUrl;
          embedPlaceholder.classList.remove("active");
          embedPlaceholderTitle.textContent = "Power BI em breve";
          embedPlaceholderMessage.textContent = "Estamos preparando o link deste painel no Power BI. Tente novamente mais tarde.";
        } else {
          powerBIFrame.src = "";
          powerBIFrame.classList.add("hidden");
          embedPlaceholder.classList.add("active");
          embedPlaceholderTitle.textContent = "Power BI em breve";
          embedPlaceholderMessage.textContent = `O painel ${panel.titulo} ainda não possui link do Power BI. Assim que o embed estiver disponível, ele aparecerá automaticamente aqui.`;
        }

        alternarView("embed");
      }

      function alternarView(view) {
        viewAtual = view;
        Object.entries(views).forEach(([key, section]) => {
          section.classList.toggle("active", key === view);
        });
        atualizarLinkAjuda();
        atualizarTituloPagina();
      }

      document.querySelectorAll('[data-action="go-home"]').forEach((button) => {
        button.addEventListener("click", (event) => {
          event.preventDefault();
          if (temaHome) {
            selecionarTema(temaHome.id, { abrirPrimeiroPainel: true });
            return;
          }

          const fallbackTema = data.find(
            (item) => item.mostrarNoMenu !== false && Array.isArray(item.dashboards) && item.dashboards.length,
          );

          if (fallbackTema) {
            selecionarTema(fallbackTema.id);
            return;
          }

          temaAtual = null;
          painelAtual = null;
          panelGrid.innerHTML = "";
          powerBIFrame.src = "";
          powerBIFrame.classList.add("hidden");
          embedPlaceholder.classList.add("active");
          embedPlaceholderTitle.textContent = "Selecione um painel";
          embedPlaceholderMessage.textContent = "Escolha um painel para visualizar o relatório do Power BI.";
          setActiveNav(null);
          alternarView("themes");
        });
      });

      window.addEventListener("resize", ajustarFonteMenu);
      document.addEventListener("fullscreenchange", atualizarEstadoFullscreen);
      document.addEventListener("webkitfullscreenchange", atualizarEstadoFullscreen);
      document.addEventListener("mozfullscreenchange", atualizarEstadoFullscreen);
      document.addEventListener("MSFullscreenChange", atualizarEstadoFullscreen);

      if (fullscreenToggle) {
        fullscreenToggle.addEventListener("click", () => {
          if (estaEmTelaCheia()) {
            sairTelaCheia().catch(() => {});
          } else {
            entrarTelaCheia(document.documentElement).catch(() => {});
          }
        });
      }

      atualizarLinkAjuda();
      atualizarTituloPagina();
      atualizarEstadoFullscreen();
      ajustarFonteMenu();
      carregarMenu();
    </script>
  </body>
</html>
